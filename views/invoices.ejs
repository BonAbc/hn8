<%- include("partials/header.ejs") %>
<!--Remember this include when add a new page-->
<main class="container">
  <!--main should move to main page-->
  <!---->
  <form>
    <label for="date">Date:</label>
    <input type="date" id="date" name="date" value="<%= defaultDate %>" />
  </form>

  <!---->
  <h2 id="hm">Accounting</h2>
  <div class="invoice-container">
    <h2>Create Invoice</h2>

    <form action="/save-invoice" method="POST">
      <!-- Company & Client -->
     <div>
        <label>Company:</label>
   <select name="company_id" required disabled >
    <!--select name="company_id" required disabled üëà-->
           <option value="">-- Select Company --</option>
          <% companies.forEach(company => { %>
          <option value="<%= company.id %>"><%= company.name %></option>
          <% }) %>
            <% companies.forEach(company => { %>
      <option value="<%= company.id %>"><%= company.name %></option>
      <% }) %>
        </select>

        <label>Client:</label>
         
        <select name="client_id" required disabled>
           <option value="">-- Select Client --</option>
          <% clients.forEach(client => { %>
          <option value="<%= client.id %>"><%= client.name %></option>
          <% }) %>
        </select>
      </div>



      <!-- Dates & Tax -->
      <div>
        <label>Due Date:</label>
        <input
          type="date"
          name="due_date"
          value="<%= defaultDate %>"
          required
        />

        
      </div>

      <!-- Invoice Items -->
     <!-- Section for listing invoice items -->
<h3>Items</h3>

<div id="items">
  <!-- Default item row (one item to start with) -->
  <div class="item-row">
    <!-- Description field -->
    <input
      type="text"
      name="description[]"
      placeholder="Description"
      required
      readonly
    />

    <!-- Quantity field (calls calculateTotals when changed) -->
    <input
      type="number"
      name="qty[]"
      placeholder="Qty"
      min="0"
      required
      oninput="calculateTotals()"
      readonly
    />

    <!-- Unit price field (calls calculateTotals when changed) -->
    <input
      type="number"
      step="0.01"
      name="unit_price[]"
      placeholder="Unit Price"
      min="0"
      required
      oninput="calculateTotals()"
      readonly
    />
  <input
            type="number"
            step="0.01"
            name="tr[]"
            placeholder="Tax %"
            min="0"
            required
            oninput="calculateTotals()"
            readonly
          />
              <!-- Dynamic ST -->
          <select name="st[]" required disabled>
            <option value="">-State-</option>
            <% states.forEach(state => { %>
            <option value="<%= state %>"><%= state %></option>
            <% }) %>
          </select>
          <input
            type="text"
            class="st-new"
            placeholder="Add state"
            onblur="addNewOption(this, 'st-dropdown')"
            readonly
          />

          <!-- Dynamic Local -->
          <select name="local[]" required disabled>
            <option value="">-Local-</option>
            <% locals.forEach(local => { %>
            <option value="<%= local %>"><%= local %></option>
            <% }) %>
          </select>
          <input
            type="text"
            class="local-new"
            placeholder="Add local"
            onblur="addNewOption(this, 'local-dropdown')"
            readonly
          />
    <!-- Remove button (üóëÔ∏è) - deletes this item row -->
    <button type="button" class="remove-btn" disabled onclick="removeItem(this)">
      üóëÔ∏è Remove
    </button>
  </div>
</div>

<!-- Button to add new item rows dynamically -->
<button type="button" onclick="addItem()" disabled style="  opacity: 1;
          background-color: #198754;
          border-color: #198754;
          color: white;
          cursor: not-allowed;"> Add Item</button>
    

<!-- ============================= -->
<!--          TOTALS AREA          -->
<!-- ============================= -->
<div class="totals">
  <p>Subtotal: $<span id="subtotal"></span></p>
  <p>Tax: $<span id="tax"></span></p>
  <h3>Total: $<span id="total"></span></h3>
</div>

<!-- ============================= -->
<!--     PAYMENT INFORMATION       -->
<!-- ============================= -->
<h3>Payment Info</h3>
<div>
  <input type="text" name="bank" placeholder="Bank Name" required readonly/>
  <input type="text" name="account_name" placeholder="Account Name" required readonly />
  <input type="text" name="account_number" placeholder="Account Number" required readonly />
  <input type="text" name="routing" placeholder="Routing Number" required readonly/> 
</div>
 <h3>Payment Status</h3>
      <div class="payment-status mt-3">
        <div>
          <label for="apaid">Amount Paid:</label>
          <input
            type="number"
            step="0.01"
            name="apaid"
            id="apaid"
            placeholder="Enter amount paid"
            value=""
            oninput="updateBalance()"
             readonly
          />
        </div>
        <div>
          <label for="bal">Balance:</label>
          <input
            type="number"
            step="0.01"
            name="bal"
            id="bal"
            placeholder="Remaining balance"
            value=""
            readonly
          />
        </div>
        <div>
          <label for="pstatus">Payment Status:</label>
          <input
            type="text"
            name="pstatus"
            id="pstatus"
            placeholder="Unpaid / Partial / Paid"
            value="Paid"
            readonly
          />
        </div>
      </div>
      <div>
 <button type="submit" disabled style="  background-color: #198754;
          border-color: #198754;
          color: white;
          opacity: 1;
          cursor: not-allowed;">Save</button>
          </div>
</div>
<br />



 <h5>We Handle the Numbers, You Grow the Business.</h5>

</main>


<!-- Link external JS -->
<script src="/js/invoices.js"></script>
<!-- Link external JS end -->
  <!--Refer to index.ejs how to include header and footer.ejs-->

<%- include("partials/footer.ejs") %><!--Remember this include when add a new page-->